:root {
    --cake-h: 40px;
    --brown: #6d4c41;
    --pink: #f06292;
    --yellow: #ffeb3b;
}

body {
    background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
    margin: 0; padding: 0; overflow: hidden; height: 100vh;
    font-family: 'Segoe UI', sans-serif;
    touch-action: manipulation;
}

.hidden { display: none !important; }

/* Nubes Decorativas */
.cloud {
    position: fixed; background: white; width: 120px; height: 40px;
    border-radius: 50px; opacity: 0.6; z-index: -1;
    animation: moveClouds linear infinite;
}
.cloud::after { content: ''; position: absolute; background: white; width: 50px; height: 50px; top: -25px; left: 20px; border-radius: 50%; }
.cloud::before { content: ''; position: absolute; background: white; width: 40px; height: 40px; top: -15px; left: 60px; border-radius: 50%; }

@keyframes moveClouds {
    from { transform: translateX(-200px); }
    to { transform: translateX(calc(100vw + 200px)); }
}

/* UI y Pantallas */
#user-screen, #game-over-screen {
    position: fixed; inset: 0; background: rgba(0,0,0,0.8);
    z-index: 2000; display: flex; justify-content: center; align-items: center;
}
.modal { background: white; padding: 30px; border-radius: 25px; text-align: center; border: 6px solid var(--brown); width: 85%; max-width: 400px; }

#ui { position: fixed; width: 100%; top: 20px; text-align: center; z-index: 500; }
#score-box { background: white; display: inline-block; padding: 10px 30px; border-radius: 50px; border: 4px solid var(--brown); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

#wind-alert {
    display: none; color: #d32f2f; font-weight: bold; font-size: 1.2rem;
    background: rgba(255,255,255,0.9); padding: 5px 15px; border-radius: 20px;
    margin-top: 10px; animation: flash 1s infinite;
}
@keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

/* Sistema de Grúa */
#crane-system { position: fixed; top: 0; width: 100%; z-index: 400; }
#crane { position: absolute; top: 0; left: 50%; width: 4px; height: 260px; background: #333; transform-origin: top center; }
#active-cake-container { position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%); }

/* MUNDO Y TORRE (El secreto del apilado) */
#game-world { 
    width: 100%; height: 100%; 
    display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
    transition: transform 0.4s ease-out; 
}

#base-container { 
    position: relative; margin-bottom: 20px;
    transform-origin: bottom center; 
    display: flex; flex-direction: column; align-items: center;
}

#tower { 
    display: flex; 
    flex-direction: column-reverse; /* Las nuevas tartas se apilan ARRIBA */
    align-items: center; 
    width: 100%;
}

#base { width: 220px; height: 40px; background: #8d6e63; border: 4px solid var(--brown); border-radius: 8px; }

/* TARTAS */
.cake { 
    height: var(--cake-h); border-radius: 6px; border: 3px solid var(--brown); 
    box-sizing: border-box; flex-shrink: 0;
}
.f-1 { background: #f06292; border-bottom: 6px solid #d81b60; }
.f-2 { background: #ba68c8; border-bottom: 6px solid #8e24aa; }
.f-3 { background: #fff176; border-bottom: 6px solid #fbc02d; }

.cake.perfect { box-shadow: 0 0 15px white, 0 0 25px var(--yellow); border: 3px solid white !important; }

/* Partículas y Textos */
.crumb { position: fixed; width: 6px; height: 6px; border-radius: 2px; z-index: 1001; animation: crumbFall 0.8s forwards; }
@keyframes crumbFall { to { transform: translate(var(--dx), 100px); opacity: 0; } }

.perfect-text { position: fixed; color: var(--yellow); font-weight: bold; font-size: 30px; text-shadow: 2px 2px 0 #000; z-index: 1500; pointer-events: none; }
